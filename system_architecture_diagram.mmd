graph TB
    %% External Interfaces
    User[ğŸ‘¤ User]
    Frontend[ğŸ–¥ï¸ React Frontend<br/>Dashboard]
    WebhookAPI[ğŸŒ Webhook API<br/>External Integrations]
    
    %% Core Infrastructure Layer
    subgraph "Core Infrastructure"
        MessageBus[ğŸ“¡ Message Bus<br/>Pub/Sub System]
        EventBridge[ğŸŒ‰ Event Bridge<br/>WebSocket Integration]
        AgentRegistry[ğŸ“‹ Agent Registry<br/>State Management]
        TaskScheduler[âš¡ Task Scheduler<br/>Assignment Logic]
        
        %% Git and Branch Management
        GitWorkflow[ğŸ”€ Git Workflow<br/>Branch Management]
        BranchManager[ğŸŒ¿ Branch Manager<br/>Legacy Git Ops]
        
        %% Monitoring and Quality
        FlowTracker[ğŸ“Š Flow Tracker<br/>Agent Communication]
        ChangeTracker[ğŸ‘ï¸ Change Tracker<br/>File Monitoring]
        MetricsCollector[ğŸ“ˆ Metrics Collector<br/>System Resources]
        
        %% Self-Healing Infrastructure
        SelfHealingCoordinator[ğŸ”§ Self-Healing<br/>Coordinator]
        RetryHandlers[ğŸ”„ Retry Handlers<br/>Fault Tolerance]
    end
    
    %% RAG Service Layer
    subgraph "RAG Knowledge System"
        RAGService[ğŸ§  RAG Service<br/>Core Orchestrator]
        
        %% RAG Components
        Chunker[âœ‚ï¸ Code Chunker<br/>Semantic Parsing]
        Embeddings[ğŸ”— Embeddings Service<br/>OpenAI Integration]
        VectorStore[ğŸ—„ï¸ Vector Store<br/>ChromaDB]
        SearchEngine[ğŸ” Search Engine<br/>Hybrid Search]
        
        %% RAG Clients
        BasicRAGClient[ğŸ“± Basic RAG Client<br/>Core Interface]
        AdaptiveRAGClient[ğŸ¯ Adaptive RAG Client<br/>Quality Learning]
        RetryEnhancedRAGClient[ğŸ›¡ï¸ Retry Enhanced Client<br/>Fault Tolerance]
    end
    
    %% Agent Factory and Management
    subgraph "Agent Factory & Context"
        AgentFactory[ğŸ­ Agent Factory<br/>Service Injection]
        AgentContext[ğŸ“‹ Agent Context<br/>Shared Services]
        IntegratedAgentBase[ğŸ”— Integrated Agent Base<br/>Common Integration]
    end
    
    %% Specialized Agents
    subgraph "Orchestration Agents"
        RequestPlanner[ğŸ¯ Request Planner<br/>Natural Language â†’ Plans]
        Architect[ğŸ—ï¸ Architect Agent<br/>System Design & Tasks]
    end
    
    subgraph "Implementation Agents"
        CodingAgent[ğŸ’» Coding Agent<br/>Code Generation]
        TestAgent[ğŸ§ª Test Agent<br/>Test Generation & Execution]
        CodePlanner[ğŸ“‹ Code Planner<br/>Implementation Planning]
    end
    
    subgraph "Analysis Agents"
        AnalyzerAgent[ğŸ” Analyzer Agent<br/>Architecture Analysis]
    end
    
    %% Task Management System
    subgraph "Task Graph System"
        TaskGraphManager[ğŸ“Š Task Graph Manager<br/>Hierarchical Tasks]
        EnhancedTaskGraph[ğŸŒ Enhanced Task Graph<br/>Dependencies & Communities]
        CommunityDetector[ğŸ¤ Community Detector<br/>Task Clustering]
    end
    
    %% Data Flow Connections
    
    %% User Interactions
    User --> Frontend
    User --> WebhookAPI
    Frontend -.->|WebSocket| EventBridge
    WebhookAPI --> RequestPlanner
    
    %% Core Infrastructure Connections
    EventBridge --> MessageBus
    MessageBus --> AgentRegistry
    MessageBus --> FlowTracker
    AgentRegistry --> TaskScheduler
    
    %% Agent Factory System
    AgentFactory --> AgentContext
    AgentContext --> IntegratedAgentBase
    AgentContext --> GitWorkflow
    AgentContext --> BranchManager
    
    %% RAG Service Internal Flow
    RAGService --> Chunker
    RAGService --> Embeddings
    RAGService --> VectorStore
    RAGService --> SearchEngine
    Chunker --> VectorStore
    Embeddings --> VectorStore
    VectorStore --> SearchEngine
    
    %% RAG Client Hierarchy
    BasicRAGClient --> RAGService
    AdaptiveRAGClient --> BasicRAGClient
    RetryEnhancedRAGClient --> AdaptiveRAGClient
    
    %% Agent Creation and Integration
    IntegratedAgentBase --> RequestPlanner
    IntegratedAgentBase --> Architect
    IntegratedAgentBase --> CodingAgent
    IntegratedAgentBase --> TestAgent
    IntegratedAgentBase --> AnalyzerAgent
    IntegratedAgentBase --> CodePlanner
    
    %% Task System Integration
    Architect --> TaskGraphManager
    TaskGraphManager --> EnhancedTaskGraph
    EnhancedTaskGraph --> CommunityDetector
    TaskGraphManager --> TaskScheduler
    
    %% Agent Communication Flow
    RequestPlanner -->|Creates Tasks| TaskGraphManager
    TaskScheduler -->|Assigns Tasks| CodingAgent
    TaskScheduler -->|Assigns Tasks| TestAgent
    TaskScheduler -->|Assigns Tasks| AnalyzerAgent
    TaskScheduler -->|Requests Plans| CodePlanner
    
    %% RAG Integration with Agents
    RequestPlanner -.->|Search Similar Plans| RetryEnhancedRAGClient
    Architect -.->|Architecture Context| RetryEnhancedRAGClient
    CodingAgent -.->|Implementation Patterns| RetryEnhancedRAGClient
    TestAgent -.->|Test Patterns| RetryEnhancedRAGClient
    AnalyzerAgent -.->|Store Analysis| RetryEnhancedRAGClient
    CodePlanner -.->|Planning Context| RetryEnhancedRAGClient
    
    %% Inter-Agent Communication
    RequestPlanner -->|Planning Events| MessageBus
    Architect -->|Task Events| MessageBus
    CodingAgent -->|Code Events| MessageBus
    TestAgent -->|Test Events| MessageBus
    AnalyzerAgent -->|Analysis Events| MessageBus
    
    %% Agent Coordination Patterns
    CodingAgent -.->|Implementation Context| TestAgent
    AnalyzerAgent -.->|Architecture Insights| Architect
    CodePlanner -.->|Detailed Plans| CodingAgent
    
    %% Git Integration
    CodingAgent --> GitWorkflow
    CodingAgent --> BranchManager
    GitWorkflow --> ChangeTracker
    
    %% Monitoring Integration
    MessageBus --> FlowTracker
    AgentRegistry --> MetricsCollector
    ChangeTracker --> AnalyzerAgent
    
    %% Self-Healing Integration
    RetryHandlers --> SelfHealingCoordinator
    SelfHealingCoordinator -.->|Recovery Actions| MessageBus
    
    %% Event Flow to Frontend
    MessageBus --> EventBridge
    EventBridge -.->|Real-time Updates| Frontend
    
    %% Styling
    classDef userInterface fill:#e1f5fe,stroke:#01579b,color:#000
    classDef infrastructure fill:#f3e5f5,stroke:#4a148c,color:#000
    classDef ragSystem fill:#e8f5e8,stroke:#1b5e20,color:#000
    classDef agents fill:#fff3e0,stroke:#e65100,color:#000
    classDef taskSystem fill:#fce4ec,stroke:#880e4f,color:#000
    classDef gitSystem fill:#f1f8e9,stroke:#33691e,color:#000
    
    class User,Frontend,WebhookAPI userInterface
    class MessageBus,EventBridge,AgentRegistry,TaskScheduler,FlowTracker,ChangeTracker,MetricsCollector,SelfHealingCoordinator,RetryHandlers infrastructure
    class RAGService,Chunker,Embeddings,VectorStore,SearchEngine,BasicRAGClient,AdaptiveRAGClient,RetryEnhancedRAGClient ragSystem
    class RequestPlanner,Architect,CodingAgent,TestAgent,AnalyzerAgent,CodePlanner,AgentFactory,AgentContext,IntegratedAgentBase agents
    class TaskGraphManager,EnhancedTaskGraph,CommunityDetector taskSystem
    class GitWorkflow,BranchManager gitSystem